- Acil bir durumda kodumuza bir şeyler eklememizin gerektiği bir senaryo düşünelim. O kadar acil ki katmanlı bir mimaride, kodumuzu ait olmaması gerken bir katmana yazıp hızlıca sonuç almak istiyoruz. "Şimdi buraya yazayım, sonra düzeltirim." dediğimiz duruma ***Teknik Borçlanma - Technical Debt*** diyoruz. Eğer böyle bir borçlanmaya gireceksek te sonrasında kendimizi koruyacak şekilde girmemiz gerekir. Yazdığımız kodun ***Refactor*** edilebilir bir kod olmasını sağlamamız gerekiyor.

``` cs 
class CustomerManager{
    
    public void AddCustomer(Customer customer){

        if( !String.IsNullOrEmpty(customer.FirstName) &&
            !String.IsNullOrEmpty(customer.LastName) &&
            !String.IsNullOrEmpty(customer.IdentityNumber))
        {
            Console.WriteLine("Eklendi");
            Console.WriteLine("Eklendi");
            Console.WriteLine("Eklendi");
        }
    }
}
```
- Eğer yukarıdaki gibi bir kod yazarsak, hatalı bir yazım yapmış oluruz. Çünkü doğrulama kodlarını ve iş kodlarını aynı fonksiyon içerisinde beraber yazdık. İlerleyen zamanlarda başka bir yerde doğrulama yapmak istersek ya da doğrulama yapmadan ekleme yapmak istersek gibi farklı senaryolarda sıkıntı yaşayacağız. "Şimdilik yazayım sonra düzelteceğim." dediğimiz zaman **Teknik Borçlanma** durumuna girmiş oluyoruz. Durumumuz gereği böyle bir kod yazmak zorundaysak o zaman şu şekilde yazmalıyız:
``` cs 
class CustomerManager{
    
    public void AddCustomer(Customer customer){

        if( String.IsNullOrEmpty(customer.FirstName) ||
            String.IsNullOrEmpty(customer.LastName) ||
            String.IsNullOrEmpty(customer.IdentityNumber))
        {
            throw new Exception("Doğrulama hatası yapıldı.");
        }

        Console.WriteLine("Eklendi");
        Console.WriteLine("Eklendi");
        Console.WriteLine("Eklendi");
    }
}
```

- Hala borçlu durumda olsak bile kodumuzun **Refactor** edilebilirliğini arttırmış olduk. Karmaşıklık seviyesini azalttık. Artık kodumuzu **Refactor** etmek istersek şu şekilde yazabiliriz:

```cs
class CustomerManager{
    
    public void AddCustomer(Customer customer){

        Vaildate(customer);
    
        Console.WriteLine("Eklendi");
    }

    private void Validate(Customer customer){
        
        if( String.IsNullOrEmpty(customer.FirstName) ||
            String.IsNullOrEmpty(customer.LastName) ||
            String.IsNullOrEmpty(customer.IdentityNumber))
        {
            throw new Exception("Doğrulama hatası yapıldı.");
        }
    }
}
```

- Kodumuz önceki halinden biraz daha iyi durumda fakat hala olması gerektiği gibi değil. Kodumuzu daha da iyi hale getirmek istersek bazı değişikliklere gitmemiz gerekiyor. Şu şekilde yazabiliriz.



```cs
public void Main(string[], args){

    CustomerManager customerManager = new CustomerManager();
    
    customerManager.AddCustomer(
        new Customer 
        {
            FirstName = "Ahmet",
            LastName = "Sezgin",
            IdentityNumber = "123"
        });

    // Burada diğer ekleme durumlarından farklı olarak "FirstName'in uzunluğu minimun 10 olmalı" şeklinde bir doğrulama koymamız gerektiğini düşünelim.
    customerManager.AddCustomerOtherBusiness(
        new Customer 
        {
            FirstName = "Ahmet",
            LastName = "Sezgin",
            IdentityNumber = "123", 
            CityId = 123 
        });

    customerManager.AddCustomer(
        new Customer 
        {
            FirstName = "Ahmet",
            LastName = "Sezgin",
            IdentityNumber = "123"
        });
}

class CustomerManager(){

    public void AddCustomer(Customer customer){

        ValidateFirstName(customer);
        ValidateLastName(customer);
        ValidateIdentityNumber(customer);

        CustomerDal customerDal = new CustomerDal();
        customerDal.Add(customer);

    }

        public void AddCustomerOtherBusiness(Customer customer){

        ValidateFirstName(customer);
        ValidateFirstNameLength(customer);
        ValidateLastName(customer);
        ValidateIdentityNumber(customer);

        CustomerDal customerDal = new CustomerDal();
        customerDal.Add(customer);

    }

    private void ValidateFirstName(Customer customer){
        
        if( String.IsNullOrEmpty(customer.FirstName))
        {
            throw new Exception("Doğrulama hatası yapıldı.");
        }
    }

    private void ValidateFirstNameLength(Customer customer){
        
        // OtherBusiness için yazdığımız ayrı doğrulama işlemi
        if(customer.FirstName.Length < 10)
        {
            throw new Exception("Doğrulama hatası yapıldı.");
        }
    }

    private void ValidateLastName(Customer customer){
        
        if( String.IsNullOrEmpty(customer.LastName))
        {
            throw new Exception("Doğrulama hatası yapıldı.");
        }
    }

    private void ValidateIdentityNumber(Customer customer){
        
        if( String.IsNullOrEmpty(customer.IdentityNumber))
        {
            throw new Exception("Doğrulama hatası yapıldı.");
        }
    }
}

class CustomerDal(){
    
    // Veri erişim katmanında asla iş kodu yazılmaz. Veriyi veritabanına eklemeye yönelik tek kod yazılabilir.
    public void Add(Customer customer){
        Console.WriteLine("Veritabanına eklendi");
    }
}

class Customer {
    public int Id { get; set;}
    public int CityId { get; set;} // Foreign key
    
    public string FirstName { get; set;}
    public string LastName { get; set;}
    public string IdentityNumber { get; set;}
}
```

- Artık sistem oldukça modüler hale geldi. Örnek olarak diyelim ki bir değişiklik yapmamız istendi. Sistemimizi yabancılar da kullanmaya başladı ve onların TC kimlik numaraları olmadığı için ```IdentityNumber``` doğrulaması yapmak istemiyoruz. Yani ```IdentityNumber``` kısmı artık boş olabilir. Yapacağımız tek şey ```Manager``` içerisindeki ```Add``` fonksiyonlarındaki ```ValidateIdentityNumber(customer);``` kısımları kaldırmak. Artık değişiklik yapılacağı zaman, yazdığımız koda müdahalemizi minimuma indirmeye başladık.

- Yukarıdaki sistem artık önceki hallerine göre oldukça iyi hale geldi. Artık daha da iyi hale getirmek istersek sisteme ```Fluent Validation``` ekleyeceğiz.